<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv = "x-ua-compatible" content = "ie=edge">
    <meta name = "viewport" content = "width=device-width initial-scale=1">
    
    <title>Font Asset Generator</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BmbxuPwQa2lc/FVzBcNJ7UAyJxM6wuqIj61tLrc4wSX0szH/Ev+nYRRuWlolflfl" crossorigin="anonymous">

    <style>
        figure, figure a, figure a img { width: 100%; }
        figure a img { image-rendering: pixelated; }
        .jumbotron { background-color: transparent; }
    </style>

</head>

<body>

    <div class="container-lg">

        <div class="row mt-5">
            <div class="col">
                <h1 class="display-4"><strong>Font Asset</strong> Generator</h1>
                <p class="lead">Generate font assets, i.e., <strong>font description</strong> file (.fnt) and <strong>glyph atlas</strong> (distance map in .png) for real-time font rendering.</p>               
            </div>
        </div>

    <div>

    <div class="container-lg">

        <div class="row justify-content-start mt-5">
            <div class="col-4 col-md-6 col-sm-12">

                <div class="input-group mb-3">
                    <label class="input-group-text" for="input-font">Choose Font</label>
                    <select class="form-select" id="input-font">
                        <option selected value="">Choose...</option>
                        <option value="./open-sans--regular.fnt">Open Sans - Regular</option>
                        <option value="./times-new-roman--regular.fnt">Times New Roman - Regular</option>
                        <option value="./roboto--regular.fnt">Roboto - Regular</option>
                    </select>
                    <!--<button class="btn btn-outline-secondary" type="button">Refresh</button>-->
                </div>

                <div id="file-api-missing-alert" class="alert alert-danger d-none" role="alert">
                    The File APIs, required for font file, are not fully supported in this browser.
                </div>
                <div class="input-group mb-5">
                    <input type="file" class="form-control" id="input-file" accept="font/*">
                    <button class="btn btn-outline-secondary" type="button" id="upload-file">Upload Font File</button>
                </div>

                <div class="mb-3 row">
                    <div class="col-3 text-end">
                        <label for="fontsize-range" class="form-label">Font Size in <strong>px</strong>:</label>
                    </div>
                    <div class="col">
                        <input type="range" class="form-range" min="8" max="128" step="1" id="fontsize-range" value="64">
                    </div>
                    <div class="col-2">
                        <input type="number" class="form-control form-control-sm"  min="8" max="128" id="fontsize-number" value="64">
                    </div>
                </div>

                <div class="mb-3 row">
                    <div class="col-3 text-end">
                        <label for="downscale-range" class="form-label">Down Scale:</label>
                    </div>
                    <div class="col">
                        <input type="range" class="form-range" min="0" max="8" step="1" id="downscale-range" value="4">
                    </div>
                    <div class="col-2">
                        <input type="number" class="form-control form-control-sm" min="0" max="8" id="downscale-number" value="4">
                    </div>
                </div>

                <div class="mb-3 row">
                    <div class="col-3 text-end">
                        <label for="padding-range" class="form-label">Padding in <strong>px</strong>:</label>
                    </div>
                    <div class="col">
                        <input type="range" class="form-range" min="-4" max="16" step="1" id="padding-range" value="8">
                    </div>
                    <div class="col-2">
                        <input type="number" class="form-control form-control-sm" min="-4" max="16" id="padding-number" value="8">
                    </div>
                </div>

                <div class="mb-4 row">
                    <div class="col-3 text-end">
                        <label for="character-whitelist" class="form-label">Character Whitelist:</label>
                    </div>
                    <div class="col-9">
                        <div class="input-group mb-3">
                            <div class="input-group-text">
                                <input class="form-check-input mt-0" id="character-check" type="checkbox" value="">
                            </div>
                            <input type="text" class="form-control form-control-sm" id="character-text">
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-3 text-end">
                        <label for="character-whitelist" class="form-label">Preview Text:</label>
                    </div>
                    <div class="col-9">
                        <textarea class="form-control form-control-sm" id="preview-text" rows="4"></textarea> 
                    </div>
                </div>

            </div>

            <div class="col-8 col-md-6 col-sm-12">
                <div class="ratio ratio-4x3">
                    <canvas class="embed-responsive-item w-100" id="canvas"></canvas>
            </div>

        </div>

    </div>


    
    <script src="https://cdn.jsdelivr.net/npm/rxjs@latest/bundles/rxjs.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js"></script>-->
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/webgl-operate@latest/dist/webgl-operate.min.js"></script>


    <script src = "index.js"></script>


    <script>
        if (!window.File || !window.FileReader || !window.FileList || !window.Blob) {
            $('#file-api-missing-alert').toggleClass('d-none');
        }

 
        let canvas = null;
        let context = null;
        let controller = null;
        let gl = null;
        let renderer = null;

        window.onload = () => { 
            
            const element = $('#canvas')[0];

            canvas = new gloperate.Canvas(element, {
                alpha: false, antialias: false, depth: true, failIfMajorPerformanceCaveat: false,
                premultipliedAlpha: false, preserveDrawingBuffer: false, stencil: false,
            });
            canvas.controller.multiFrameNumber = 64;

            var blocker = new gloperate.viewer.EventBlocker(canvas.element);
                blocker.block('contextmenu');

            element.addEventListener('click', (event) => {
                if (event.ctrlKey) { gloperate.viewer.Fullscreen.toggle(element); }
            });

            context = canvas.context;
            controller = canvas.controller;
            gl = canvas.context.gl;

            renderer = new Renderer();            
            canvas.renderer = renderer; 

            // renderer.change('./roboto-test.fnt');
            // todo: trigger font change on renderer when appropriate 
        }

        const inputFont = $('#input-font');
        
        inputFont.on('click', (e) => {
            renderer.change(e.target.value);
        });

        const inputFile = $('#input-file');
        const uploadFile = $('#upload-file');
      
        uploadFile.on('click', () => {
            const file = inputFile.get(0).files[0];
            renderer.change(file.name);
        });


        const fontsizeRange = $('#fontsize-range');
        const fontsizeNumber = $('#fontsize-number');
        fontsizeRange.on('input', (e) => fontsizeNumber.val(e.target.value));
        fontsizeNumber.on('input', (e) => fontsizeRange.val(e.target.value));

        const downscaleRange = $('#downscale-range');
        const downscaleNumber = $('#downscale-number');
        downscaleRange.on('input', (e) => downscaleNumber.val(e.target.value));
        downscaleNumber.on('input', (e) => downscaleRange.val(e.target.value));

        const paddingRange = $('#padding-range');
        const paddingNumber = $('#padding-number');
        paddingRange.on('input', (e) => paddingNumber.val(e.target.value));
        paddingNumber.on('input', (e) => paddingRange.val(e.target.value));

        const previewText = $('#preview-text');
        previewText.on('input', (e) => renderer.text(e.target.value));

        previewText.val(
`Come, fill the Cup, and in the fire of Spring
Your Winter garment of Repentance fling:
The Bird of Time has but a little way
To flutterâ€”and the Bird is on the Wing.`);
        renderer.text(previewText.val());

        // const paddingRange = $('#padding-range');
        // const paddingNumber = $('#padding-number');
        // paddingRange.on('input', (e) => paddingNumber.val(e.target.value));
        // paddingNumber.on('input', (e) => paddingRange.val(e.target.value));

    </script>  

</body>

</html>